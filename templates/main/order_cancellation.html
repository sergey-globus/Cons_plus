{% extends 'base.html' %}

{% block title %}Отмена заказа продавцом - Правовой портал{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="hero-section-small text-white rounded p-4 mb-5">
                <h1 class="display-5 text-center">Что делать если продавец/маркетплейс в одностороннем порядке отменил заказ?</h1>
                <p class="lead text-center">Защита прав покупателей при отмене заказов</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-9">
            <article class="legal-article">
                <div class="legal-text">
                    <p class="lead">
                        Когда вы, как покупатель, оформляете заказ на маркетплейсе, вы становитесь стороной договора розничной
                        <span class="tooltip-term" tabindex="0" data-term="sale_contract">
                            купли-продажи
                        </span>.
                        Этот договор считается заключенным в надлежащей форме с момента выдачи продавцом покупателю кассового или товарного чека, электронного или иного документа, подтверждающего оплату товар, то есть с того момента, как вы оплатили товар.
                    </p>

                    <div class="law-reference">
                        <i class="fas fa-balance-scale"></i>
                        <span>Статья 493 ГК РФ</span>
                        <a href="https://www.consultant.ru/document/cons_doc_LAW_9027/b5643246a03521732258dc7bd7c2b28e0a952bde/" target="_blank" class="btn btn-sm btn-outline-primary">Читать закон</a>
                    </div>

                    <p>Часто при покупке товаров на маркетплейсах возникает проблема, когда продавец отменяет заказ в одностороннем порядке по сомнительным причинам или без объяснения.</p>

                    <div class="important-principle">
                        <h3><i class="fas fa-exclamation-triangle"></i> Принцип недопустимости одностороннего отказа</h3>
                        <p>В гражданском праве закреплен общий принцип о недопустимости одностороннего отказа от обязательства.</p>

                        <div class="law-reference">
                            <i class="fas fa-balance-scale"></i>
                            <span>Статья 310 ГК РФ</span>
                            <a href="https://www.consultant.ru/document/cons_doc_LAW_5142/33c65ab7522b599d12e61cc848aebcd09e651f9c/" target="_blank" class="btn btn-sm btn-outline-primary">Читать закон</a>
                        </div>
                    </div>

                    <h3>Когда продавец может отказаться от исполнения?</h3>
                    <p>Отказ продавца от исполнения обязательства по передаче товара возможен лишь в исключительных случаях. Например, если покупатель не выполнил встречное обязательство или явно не выполнит его в срок. В частности, это может быть обязанность по оплате товара.</p>

                    <div class="law-reference">
                        <i class="fas fa-balance-scale"></i>
                        <span>Пункт 2 статьи 328 ГК РФ</span>
                        <a href="https://www.consultant.ru/document/cons_doc_LAW_5142/331033e3d6e7b72213bd9903b03e29dfb9e608fe/" target="_blank" class="btn btn-sm btn-outline-primary">Читать закон</a>
                    </div>

                    <div class="alert alert-success">
                        <h4><i class="fas fa-check-circle"></i> Важно знать!</h4>
                        <p>Если вы не нарушали своих обязательств, у продавца нет права отменять заказ. Даже если продавец произвел возврат уплаченных за товар денежных средств, это не основание для отказа от исполнения обязательства.</p>
                        <small>Определение Второго кассационного суда общей юрисдикции от 06.02.2024 N 8Г-305/2024</small>
                    </div>

                    <h3>Условия площадки не могут нарушать закон</h3>
                    <p>Продавец не может ссылаться на то, что условия площадки (публичная оферта) позволяют ему отменить в одностороннем порядке оформленный заказ. Данное условие оферты не соответствует закону.</p>

                    <div class="law-reference">
                        <i class="fas fa-balance-scale"></i>
                        <span>Обзор судебной практики по делам о защите прав потребителей (утв. Президиумом Верховного Суда РФ 18.10.2023)</span>
                        <a href="https://www.consultant.ru/document/cons_doc_LAW_460140/e0449550c512c26e841f7eb5b84b85c51f388883/" target="_blank" class="btn btn-sm btn-outline-primary">Читать документ</a>
                    </div>

                    <h2 class="section-title">Какие возникают права у покупателя?</h2>

                    <div class="rights-list">
                        <div class="right-item">
                            <div class="right-number">1</div>
                            <div class="right-content">
                                <h4>Истребовать товар или вернуть деньги</h4>
                                <p>Вы вправе потребовать полного возмещения убытков, причиненных вследствие нарушения установленного договором купли-продажи срока передачи предварительно оплаченного товара.</p>
                                <div class="law-reference">
                                    <i class="fas fa-balance-scale"></i>
                                    <span>Пункт 2 статьи 23.1 Закона "О защите прав потребителей"</span>
                                    <a href="https://www.consultant.ru/document/cons_doc_LAW_305/cd5055f2729d0ba6bf1c3724ba16ca46ea92e0f7/" target="_blank" class="btn btn-sm btn-outline-primary">Читать закон</a>
                                </div>
                            </div>
                        </div>

                        <div class="right-item">
                            <div class="right-number">2</div>
                            <div class="right-content">
                                <h4>Потребовать возмещения неустойки</h4>
                                <p>За нарушение сроков передачи товара предусмотрена неустойка.</p>
                                <div class="law-reference">
                                    <i class="fas fa-balance-scale"></i>
                                    <span>Пункт 3 статьи 23.1 Закона "О защите прав потребителей"</span>
                                    <a href="https://www.consultant.ru/document/cons_doc_LAW_305/cd5055f2729d0ba6bf1c3724ba16ca46ea92e0f7/" target="_blank" class="btn btn-sm btn-outline-primary">Читать закон</a>
                                </div>
                            </div>
                        </div>

                        <div class="right-item">
                            <div class="right-number">3</div>
                            <div class="right-content">
                                <h4>Потребовать возмещения морального вреда</h4>
                                <p>Моральный вред, причиненный потребителю, подлежит компенсации.</p>
                                <div class="law-reference">
                                    <i class="fas fa-balance-scale"></i>
                                    <span>Статья 15 Закона "О защите прав потребителей"</span>
                                    <a href="https://www.consultant.ru/document/cons_doc_LAW_305/19c8339aa764510f25f4afcea83230cbf14cb9d3/" target="_blank" class="btn btn-sm btn-outline-primary">Читать закон</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning">
                        <h4><i class="fas fa-lightbulb"></i> Важно!</h4>
                        <p>Вы также можете приобрести аналогичный товар у данного продавца по новой цене либо у другого продавца. При этом разница в стоимости товаров между первоначально и вторично приобретенном товаре может быть компенсирована продавцом, безосновательно отказавшимся от исполнения договора.</p>
                        <div class="law-reference">
                            <i class="fas fa-balance-scale"></i>
                            <span>Статья 393.1 ГК РФ</span>
                            <a href="https://www.consultant.ru/document/cons_doc_LAW_5142/5e19a29b856da213ecaa2ee82e3d22f67fdfa897/" target="_blank" class="btn btn-sm btn-outline-primary">Читать закон</a>
                        </div>
                    </div>

                    <h2 class="section-title">Что делать покупателю в подобной ситуации?</h2>

                    <div class="action-steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Обращение к продавцу</h4>
                                <p>Разрешить вопрос напрямую с продавцом или маркетплейсом через форму на самом маркетплейсе.</p>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Досудебная претензия</h4>
                                <p>Если ваша проблема не решена, или ее решение вас не устраивает, направить досудебную претензию продавцу. Вы можете воспользоваться нашим ресурсом для составления проекта претензии.</p>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Обращение в суд</h4>
                                <p>Если ваша претензия не была удовлетворена, вы можете обратиться в суд с исковым заявлением.</p>
                            </div>
                        </div>
                    </div>

                    <div class="conclusion">
                        <h3><i class="fas fa-gavel"></i> Вывод</h3>
                        <p><strong>Отмена заказа маркетплейсом и возврат денег покупателю не исключают его обязанность передать товар.</strong></p>
                    </div>
                </div>
            </article>
        </div>

        <div class="col-md-3">
            <div class="sidebar">
                <div class="card mt-3">
                    <div class="card-header bg-warning text-white">
                        <h5><i class="fas fa-question-circle"></i> Нужна помощь?</h5>
                    </div>
                    <div class="card-body">
                        <p>Если у вас возникли вопросы, обратитесь к нашим специалистам.</p>
                        <a href="{% url 'consultation' %}" class="btn btn-warning btn-block">Получить консультацию</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Всплывающая карточка глоссария -->
<div id="glossary-popup" class="glossary-popup" role="tooltip" aria-hidden="true">
    <div class="term-header">
        <h3><i class="fas fa-file-contract"></i> Договор купли-продажи</h3>
    </div>
    <div class="term-content">
        <p><strong>Определение:</strong> Договор, по которому одна сторона (продавец) обязуется передать вещь в собственность другой стороне (покупателю), а покупатель обязуется принять эту вещь и оплатить её.</p>
        <div class="law-reference">
            <i class="fas fa-balance-scale"></i>
            <span>Статьи 454–481 Гражданского кодекса РФ</span>
        </div>
    </div>
</div>

<style>
.glossary-popup {
    position: absolute;
    max-width: 360px; /* чуть шире */
    background: white;
    border-radius: 4px;
    border: 1px solid #ccc;
    padding: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    z-index: 1050;
    font-size: 14px;
    line-height: 1.5;
    color: #2c3e50;
    opacity: 0;
    pointer-events: none;
    transform: translateY(10px);
    transition: opacity 0.25s ease, transform 0.25s ease;
}

/* Активное состояние */
.glossary-popup.visible {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
}

/* Заголовок */
.glossary-popup .term-header {
    background: var(--info-color);
    color: white;
    padding: 15px 20px;
    border-radius: 4px 4px 0 0;
    margin: -20px -20px 15px -20px;
}

.glossary-popup .term-header h3 {
    margin: 0;
    font-weight: 600;
    font-size: 1.2rem;
}

.glossary-popup .term-header i {
    margin-right: 8px;
}

/* Контент */
.glossary-popup .term-content p {
    margin-bottom: 10px;
}

.glossary-popup .law-reference {
    background: rgba(248, 249, 250, 0.8);
    border-left: 4px solid var(--info-color);
    padding: 8px 12px;
    margin-top: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-radius: 0 6px 6px 0;
    font-size: 0.85rem;
    color: #2c3e50;
}

.glossary-popup .law-reference i {
    color: var(--info-color);
}

/* Стрелочка подсказки - половина ромба (треугольник) */
.glossary-popup::before {
    content: "";
    position: absolute;
    left: 20px;
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    z-index: 1051;
}

/* Стрелочка сверху (под словом) - верхняя половина ромба, цвет градиента яркий */
.glossary-popup.arrow-top::before {
    top: -10px;
    border-bottom: 10px solid var(--info-color); /* светлый цвет из градиента */
    border-top: none;
}

/* Стрелочка снизу (над словом) - нижняя половина ромба, белая */
.glossary-popup.arrow-bottom::before {
    bottom: -10px;
    border-top: 10px solid white;
    border-bottom: none;
}

/* Стили для термина в тексте */
.tooltip-term {
    position: relative;
    cursor: pointer;
    border-bottom: 1px dotted var(--primary-color);
    color: var(--primary-color);
}

/* Мобильные устройства - отключаем подсказку */
@media (max-width: 768px) {
    .tooltip-term {
        border-bottom: none;
        cursor: default;
        color: inherit;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const glossaryPopup = document.getElementById('glossary-popup');
    const tooltipTerms = document.querySelectorAll('.tooltip-term');

    tooltipTerms.forEach(term => {
        term.addEventListener('mouseenter', () => showPopup(term));
        term.addEventListener('mouseleave', hidePopup);
        term.addEventListener('focus', () => showPopup(term));
        term.addEventListener('blur', hidePopup);
    });

    function showPopup(term) {
        const rect = term.getBoundingClientRect();
        const popupWidth = glossaryPopup.offsetWidth;
        const popupHeight = glossaryPopup.offsetHeight;
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
        const viewportHeight = window.innerHeight;
        const viewportWidth = window.innerWidth;

        glossaryPopup.classList.remove('arrow-top', 'arrow-bottom');

        // Горизонтальная позиция
        let leftPos = rect.left + scrollLeft;
        if (leftPos + popupWidth > viewportWidth - 10) {
            leftPos = viewportWidth - popupWidth - 10;
        }
        if (leftPos < 10) {
            leftPos = 10;
        }

        // Вертикальная позиция и выбор стрелочки
        let topPos;
        const spaceBelow = viewportHeight - rect.bottom;
        const spaceAbove = rect.top;

        if (spaceBelow > popupHeight + 20) {
            // Показываем снизу (под словом)
            topPos = rect.bottom + scrollTop + 8;
            glossaryPopup.classList.add('arrow-top');
        } else if (spaceAbove > popupHeight + 20) {
            // Показываем сверху (над словом)
            topPos = rect.top + scrollTop - popupHeight - 8;
            glossaryPopup.classList.add('arrow-bottom');
        } else if (spaceBelow >= spaceAbove) {
            // Если мало места, но снизу больше, показываем снизу
            topPos = rect.bottom + scrollTop + 8;
            glossaryPopup.classList.add('arrow-top');
        } else {
            // Иначе сверху
            topPos = rect.top + scrollTop - popupHeight - 8;
            glossaryPopup.classList.add('arrow-bottom');
        }

        glossaryPopup.style.left = leftPos + 'px';
        glossaryPopup.style.top = topPos + 'px';

        glossaryPopup.classList.add('visible');
        glossaryPopup.setAttribute('aria-hidden', 'false');
    }

    function hidePopup() {
        glossaryPopup.classList.remove('visible', 'arrow-top', 'arrow-bottom');
        glossaryPopup.setAttribute('aria-hidden', 'true');
    }
});
</script>
{% endblock %}
